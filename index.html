<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ứng dụng Tính Toán Doanh Thu Shopee & TikTok</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" />
  <style>
    .platform-btn {
      padding: 0.75rem 1.5rem;
      border-radius: 0.5rem;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      transition: all 0.2s ease;
      box-shadow: 0 4px 16px 0 rgba(0, 0, 0, 0.1), 0 1.5px 0 0 #e5e7eb;
      border: 2px solid #e5e7eb;
      background: #f3f4f6;
      position: relative;
    }
    .platform-btn:active {
      top: 2px;
      box-shadow: 0 2px 8px 0 rgba(0, 0, 0, 0.1);
    }
    .platform-btn.selected {
      box-shadow: 0 8px 24px 0 rgba(0, 0, 0, 0.18), 0 2px 0 0 #d97706;
      border-color: #d97706;
      z-index: 1;
    }
    .toggle-btn {
      display: inline-block;
      padding: 0.6rem 1.2rem;
      border-radius: 8px;
      border: 2px solid #e5e7eb;
      background-color: #f3f4f6;
      color: #374151;
      font-weight: 500;
      cursor: pointer;
      transition: 0.2s;
      user-select: none;
    }
    input[type="checkbox"]:checked + label.toggle-btn {
      background-color: black;
      color: white;
      border-color: black;
    }
    .day-btn {
      padding: 0.6rem 1.25rem;
      border-radius: 0.5rem;
      font-weight: 500;
      font-size: 0.95rem;
      border: 2px solid #e5e7eb;
      background: #f3f4f6;
      color: #374151;
      cursor: pointer;
      transition: all 0.2s ease;
      box-shadow: 0 4px 16px 0 rgba(0, 0, 0, 0.05);
    }
    .day-btn.active {
      background: #000;
      color: white;
      border-color: #000;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.18);
    }
  </style>
</head>
<body class="bg-gray-50 min-h-screen py-8">
  <div class="max-w-7xl mx-auto px-4">
    <h1 class="text-3xl font-bold text-center mb-8">
      <i class="fas fa-calculator mr-2"></i>Tính Toán Doanh Thu & Lợi Nhuận
    </h1>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
      <div class="bg-white rounded-lg shadow-lg p-6 border-2 border-gray-200">
        <h2 class="text-2xl font-semibold text-gray-800 mb-6">
          <i class="fas fa-edit mr-2"></i>Nhập Thông Tin
        </h2>

        <div class="mb-6">
          <label class="block text-sm font-medium mb-3">Chọn sàn bán hàng</label>
          <div class="flex space-x-4">
            <button id="shopee-btn" class="platform-btn bg-gray-300 text-gray-700 hover:bg-gray-400">
              <i class="fas fa-shopping-bag"></i><span>Shopee</span>
            </button>
            <button id="tiktok-btn" class="platform-btn bg-gray-300 text-gray-700 hover:bg-gray-400">
              <i class="fab fa-tiktok"></i><span>TikTok</span>
            </button>
          </div>
        </div>

        <div class="space-y-4 mb-6">
          <div>
            <label class="block text-sm font-medium mb-2">Giá bán sản phẩm (Nghìn .đ)</label>
            <input id="sell-price" type="number" min="0" class="w-full px-3 py-2 border rounded-md" placeholder="0" />
          </div>
          <div>
            <label class="block text-sm font-medium mb-2">Giá nhập sản phẩm (Nghìn .đ)</label>
            <input id="cost-price" type="number" min="0" class="w-full px-3 py-2 border rounded-md" placeholder="0" />
          </div>
          <div>
            <label class="block text-sm font-medium mb-2">Voucher giảm giá (Nghìn .đ)</label>
            <input id="voucher" type="number" min="0" class="w-full px-3 py-2 border rounded-md" placeholder="0" />
          </div>
          <div>
            <label class="block text-sm font-medium mb-2">Số đơn dự kiến</label>
            <input id="order-count" type="number" min="1" value="1" class="w-full px-3 py-2 border rounded-md" />
          </div>
        </div>

        <div id="tiktok-xtra-options" class="mb-6 hidden">
          <label class="block text-sm font-medium mb-3">Chọn các chương trình đã đăng ký:</label>
          <div class="flex space-x-4">
            <input type="checkbox" id="tiktok-voucher-xtra" class="hidden" />
            <label for="tiktok-voucher-xtra" class="toggle-btn">Voucher Extra</label>
          </div>
        </div>

        <div id="tiktok-day-type" class="mb-6 hidden">
          <label class="block text-sm font-medium mb-3">Phí Voucher Extra</label>
          <div class="flex space-x-4">
            <input type="radio" name="day-type" id="day-normal" value="normal" class="hidden" checked />
            <label for="day-normal" class="day-btn active">Ngày thường (2%)</label>
            <input type="radio" name="day-type" id="day-sale" value="sale" class="hidden" />
            <label for="day-sale" class="day-btn">Ngày sale (3%)</label>
          </div>
        </div>
      </div>

      <div class="bg-white rounded-lg shadow-lg p-6 border-2 border-gray-200">
        <h2 class="text-2xl font-semibold text-gray-800 mb-6">
          <i class="fas fa-chart-line mr-2"></i>Kết Quả
        </h2>
        <div class="space-y-4">
          <div class="bg-gray-50 p-4 rounded-lg border">
            <div class="flex justify-between">
              <span>Tổng phí nền tảng:</span>
              <span id="platform-fee" class="font-semibold text-red-600">0 đ</span>
            </div>
          </div>
          <div class="bg-gray-50 p-4 rounded-lg border">
            <div class="flex justify-between">
              <span>Tổng phí vận hành:</span>
              <span id="operation-fee" class="font-semibold text-red-600">0 đ</span>
            </div>
          </div>
          <div class="bg-blue-50 p-4 rounded-lg border">
            <div class="flex justify-between">
              <span>Doanh thu thực nhận:</span>
              <span id="net-revenue" class="font-bold text-blue-600">0 đ</span>
            </div>
          </div>
          <div class="bg-green-50 p-4 rounded-lg border">
            <div class="flex justify-between">
              <span>Lợi nhuận:</span>
              <span id="profit" class="font-bold text-green-600">0 đ</span>
            </div>
          </div>
        </div>

        <div class="mt-6 border-t pt-4">
          <h3 class="font-semibold mb-2"><i class="fas fa-list-ul mr-2"></i>Chi tiết phí</h3>
          <div id="fee-breakdown" class="text-sm text-gray-700"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    let currentPlatform = "shopee";
    document.getElementById("shopee-btn").addEventListener("click", () => selectPlatform("shopee"));
    document.getElementById("tiktok-btn").addEventListener("click", () => selectPlatform("tiktok"));

    function selectPlatform(platform) {
      currentPlatform = platform;
      document.getElementById("tiktok-xtra-options").classList.toggle("hidden", platform !== "tiktok");
      document.getElementById("tiktok-day-type").classList.add("hidden");
      calculateResult();
    }

    ["sell-price", "cost-price", "voucher", "order-count"].forEach(id => {
      document.getElementById(id).addEventListener("input", calculateResult);
    });
    document.querySelectorAll('input[name="day-type"]').forEach(r => r.addEventListener("change", calculateResult));
    document.getElementById("tiktok-voucher-xtra").addEventListener("change", () => {
      document.getElementById("tiktok-day-type").classList.toggle("hidden", !document.getElementById("tiktok-voucher-xtra").checked);
      calculateResult();
    });

    function formatCurrency(n) {
      return new Intl.NumberFormat("vi-VN").format(n);
    }

    function calculateResult() {
      const sellPrice = (parseFloat(document.getElementById("sell-price").value) || 0) * 1000;
      const costPrice = (parseFloat(document.getElementById("cost-price").value) || 0) * 1000;
      const voucher = (parseFloat(document.getElementById("voucher").value) || 0) * 1000;
      const orderCount = parseInt(document.getElementById("order-count").value) || 1;

      const giáSauVoucher = (sellPrice - voucher) * orderCount;
      let platformFeeDetails = [];
      let totalPlatformFee = 0;

      if (currentPlatform === "tiktok") {
        const transactionFee = giáSauVoucher * 0.05;
        const commissionFee = giáSauVoucher * 0.10;
        const dayType = document.querySelector('input[name="day-type"]:checked').value;
        const voucherExtraRate = dayType === "normal" ? 0.02 : 0.03;
        let voucherExtra = 0;
        if (document.getElementById("tiktok-voucher-xtra")?.checked) {
          voucherExtra = giáSauVoucher * voucherExtraRate;
        }

        // ✅ Phí cố định
        const sfrFee = 1620;
        const handlingFee = 3000;

        totalPlatformFee = transactionFee + commissionFee + voucherExtra + sfrFee + handlingFee;

        platformFeeDetails = [
          `Phí giao dịch (5%): ${formatCurrency(transactionFee)} đ`,
          `Phí hoa hồng nền tảng (10%): ${formatCurrency(commissionFee)} đ`,
          `Hoàn phí vận chuyển (SFR): ${formatCurrency(sfrFee)} đ`,
          `Phí xử lý đơn hàng: ${formatCurrency(handlingFee)} đ`
        ];
        if (voucherExtra > 0) {
          platformFeeDetails.splice(2, 0, `Voucher Extra Program (${voucherExtraRate * 100}%): ${formatCurrency(voucherExtra)} đ`);
        }
      }

      const netRevenue = giáSauVoucher - totalPlatformFee;
      const profit = netRevenue - costPrice * orderCount;

      document.getElementById("platform-fee").textContent = formatCurrency(totalPlatformFee) + " đ";
      document.getElementById("operation-fee").textContent = "0 đ";
      document.getElementById("net-revenue").textContent = formatCurrency(netRevenue) + " đ";
      document.getElementById("profit").textContent = formatCurrency(profit) + " đ";

      document.getElementById("fee-breakdown").innerHTML = `
        <strong>Phí nền tảng TikTok:</strong>
        ${platformFeeDetails.map(d => `<div class="ml-4">• ${d}</div>`).join("")}
      `;
    }
  </script>
</body>
</html>
